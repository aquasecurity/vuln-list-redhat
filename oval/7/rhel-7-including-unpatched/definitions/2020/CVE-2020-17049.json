{
  "Class": "vulnerability",
  "ID": "oval:com.redhat.cve:def:202017049",
  "Version": "636",
  "Metadata": {
    "Title": "Kerberos: delegation constrain bypass in S4U2Proxy (moderate)",
    "References": [
      {
        "Source": "CVE",
        "RefID": "CVE-2020-17049",
        "RefURL": "https://access.redhat.com/security/cve/CVE-2020-17049"
      }
    ],
    "Description": "DOCUMENTATION: It was found that the Kerberos Key Distribution Center (KDC) delegation feature, Service for User (S4U), did not sufficiently protect the tickets it's providing from tempering. A malicious, authenticated service principal allowed to delegate could use this flaw to impersonate a non-forwardable user. \n            STATEMENT: As a prerequisite to be vulnerable, a Key Distribution Center (KDC) must be able to accept delegation via the `Service for User` (S4U) extensions.\n\nVersion of MIT Kerberos KDC in Red Hat Enterprise Linux (provided by the krb5-server package) only allows use of the S4U extensions when configured with an LDAP backend. Furthermore, delegations are denied by default and delegation rules must be explicitly created by an administrator, between a given service principal and its targets. Such a rule would entitle that service to use delegation to the targets.  This means that, in order to exploit the flaw, an attacker would require either to trick an administrator into adding a rule for a malicious service principal, or have the knowledge of an entitled principal's secret key. The victim principals would be limited to the ones allowed by the rules for that service.\n\nIn Red Hat Enterprise Linux version 8 and older and Red Hat Gluster Storage, Samba as an Active Directory Domain Controller is not supported, and thus is not affected by this flaw.\n\nRHEL Identity Management (RHEL IdM) implements constrained delegation feature using Active Directory's Kerberos extensions called Service for User (S4U). The constrained delegation implementation may potentially be vulnerable if an attacker is capable to create constrained delegation rules. In RHEL IdM only administrators allowed to add constrained delegation rules and only one such rule exists by default for HTTP/..  principal on IdM server. Security of IdM server is the key to safety of the whole RHEL IdM deployment. If an attacker is able to impersonate the HTTP/.. service principal on IdM server, they would be able to overtake the whole deployment even without a Kerberos protocol vulnerability described by CVE-2020-17049. However, if an attacker cannot control any service with pre-existing constrained delegation rules and cannot force creation of the constrained delegation rules for other Kerberos services, they cannot utilize CVE-2020-17049 vulnerability against RHEL IdM.\n            MITIGATION: In Red Hat Identity Management (IdM), the list of existing rules for service principals  delegation can be obtained with the following commands :\n$ ipa servicedelegationrule-find\n$ ipa servicedelegationtarget-find\nThe services allowed to delegate must all be trusted.\nBy default, only HTTP/\u003cIPA host\u003e@\u003cREALM\u003e, corresponding to IdM's Web UI, is allowed to delegate.",
    "Advisory": {
      "From": "secalert@redhat.com",
      "Severity": "Moderate",
      "Issued": {},
      "Updated": {
        "Date": "2024-01-11"
      },
      "Cves": [
        {
          "CveID": "CVE-2020-17049",
          "Cvss3": "7.2/CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H",
          "Cwe": "CWE-345",
          "Impact": "moderate",
          "Href": "https://access.redhat.com/security/cve/CVE-2020-17049",
          "Public": "20201110"
        }
      ],
      "AffectedCpeList": [
        "cpe:/a:redhat:rhel_extras:7",
        "cpe:/a:redhat:rhel_extras_oracle_java:7",
        "cpe:/a:redhat:rhel_extras_rt:7",
        "cpe:/a:redhat:rhel_extras_sap:7",
        "cpe:/a:redhat:rhel_extras_sap_hana:7",
        "cpe:/o:redhat:enterprise_linux:7",
        "cpe:/o:redhat:enterprise_linux:7::client",
        "cpe:/o:redhat:enterprise_linux:7::computenode",
        "cpe:/o:redhat:enterprise_linux:7::server",
        "cpe:/o:redhat:enterprise_linux:7::workstation"
      ],
      "Affected": {
        "Resolution": {
          "State": "Will not fix"
        }
      }
    }
  },
  "Criteria": {
    "Operator": "OR",
    "Criterions": [
      {
        "Comment": "Red Hat Enterprise Linux must be installed",
        "TestRef": "oval:com.redhat.cve:tst:20042779006"
      }
    ],
    "Criterias": [
      {
        "Operator": "AND",
        "Criterions": [
          {
            "Comment": "Red Hat Enterprise Linux 7 is installed",
            "TestRef": "oval:com.redhat.cve:tst:20042779005"
          }
        ],
        "Criterias": [
          {
            "Operator": "OR",
            "Criterias": [
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5-devel is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351009"
                  },
                  {
                    "Comment": "krb5-devel is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351010"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5-workstation is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351007"
                  },
                  {
                    "Comment": "krb5-workstation is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351008"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5-libs is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351013"
                  },
                  {
                    "Comment": "krb5-libs is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351014"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5-pkinit is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351003"
                  },
                  {
                    "Comment": "krb5-pkinit is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351004"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5-server is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351011"
                  },
                  {
                    "Comment": "krb5-server is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351012"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5 is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351015"
                  },
                  {
                    "Comment": "krb5 is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351016"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "libkadm5 is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351001"
                  },
                  {
                    "Comment": "libkadm5 is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351002"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "krb5-server-ldap is installed",
                    "TestRef": "oval:com.redhat.cve:tst:20145351005"
                  },
                  {
                    "Comment": "krb5-server-ldap is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:20145351006"
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}