{
  "Class": "vulnerability",
  "ID": "oval:com.redhat.cve:def:202426921",
  "Version": "636",
  "Metadata": {
    "Title": "kernel: inet: inet_defrag: prevent sk release while still in use (low)",
    "References": [
      {
        "Source": "CVE",
        "RefID": "CVE-2024-26921",
        "RefURL": "https://access.redhat.com/security/cve/CVE-2024-26921"
      }
    ],
    "Description": "DOCUMENTATION: The CVE program describes this issue as: In the Linux kernel, the following vulnerability has been resolved:\n\ninet: inet_defrag: prevent sk release while still in use\n\nip_local_out() and other functions can pass skb-\u003esk as function argument.\n\nIf the skb is a fragment and reassembly happens before such function call\nreturns, the sk must not be released.\n\nThis affects skb fragments reassembled via netfilter or similar\nmodules, e.g. openvswitch or ct_act.c, when run as part of tx pipeline.\n\nEric Dumazet made an initial analysis of this bug.  Quoting Eric:\n  Calling ip_defrag() in output path is also implying skb_orphan(),\n  which is buggy because output path relies on sk not disappearing.\n\n  A relevant old patch about the issue was :\n  8282f27449bf (\"inet: frag: Always orphan skbs inside ip_defrag()\")\n\n  [..]\n\n  net/ipv4/ip_output.c depends on skb-\u003esk being set, and probably to an\n  inet socket, not an arbitrary one.\n\n  If we orphan the packet in ipvlan, then downstream things like FQ\n  packet scheduler will not work properly.\n\n  We need to change ip_defrag() to only use skb_orphan() when really\n  needed, ie whenever frag_list is going to be used.\n\nEric suggested to stash sk in fragment queue and made an initial patch.\nHowever there is a problem with this:\n\nIf skb is refragmented again right after, ip_do_fragment() will copy\nhead-\u003esk to the new fragments, and sets up destructor to sock_wfree.\nIOW, we have no choice but to fix up sk_wmem accouting to reflect the\nfully reassembled skb, else wmem will underflow.\n\nThis change moves the orphan down into the core, to last possible moment.\nAs ip_defrag_offset is aliased with sk_buff-\u003esk member, we must move the\noffset into the FRAG_CB, else skb-\u003esk gets clobbered.\n\nThis allows to delay the orphaning long enough to learn if the skb has\nto be queued or if the skb is completing the reasm queue.\n\nIn the former case, things work as before, skb is orphaned.  This is\nsafe because skb gets queued/stolen and won't continue past reasm engine.\n\nIn the latter case, we will steal the skb-\u003esk reference, reattach it to\nthe head skb, and fix up wmem accouting when inet_frag inflates truesize.",
    "Advisory": {
      "From": "secalert@redhat.com",
      "Severity": "Low",
      "Issued": {},
      "Updated": {
        "Date": "2025-01-20"
      },
      "Cves": [
        {
          "CveID": "CVE-2024-26921",
          "Cvss3": "5.5/CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
          "Cwe": "CWE-124",
          "Impact": "low",
          "Href": "https://access.redhat.com/security/cve/CVE-2024-26921",
          "Public": "20240418"
        }
      ],
      "AffectedCpeList": [
        "cpe:/a:redhat:enterprise_linux:9",
        "cpe:/a:redhat:enterprise_linux:9::appstream",
        "cpe:/a:redhat:enterprise_linux:9::crb",
        "cpe:/a:redhat:enterprise_linux:9::highavailability",
        "cpe:/a:redhat:enterprise_linux:9::nfv",
        "cpe:/a:redhat:enterprise_linux:9::realtime",
        "cpe:/a:redhat:enterprise_linux:9::resilientstorage",
        "cpe:/a:redhat:enterprise_linux:9::sap",
        "cpe:/a:redhat:enterprise_linux:9::sap_hana",
        "cpe:/a:redhat:enterprise_linux:9::supplementary",
        "cpe:/o:redhat:enterprise_linux:9",
        "cpe:/o:redhat:enterprise_linux:9::baseos"
      ],
      "Affected": {
        "Resolution": {
          "State": "Affected"
        }
      }
    }
  },
  "Criteria": {
    "Operator": "OR",
    "Criterions": [
      {
        "Comment": "Red Hat Enterprise Linux must be installed",
        "TestRef": "oval:com.redhat.cve:tst:20052541004"
      }
    ],
    "Criterias": [
      {
        "Operator": "AND",
        "Criterions": [
          {
            "Comment": "Red Hat Enterprise Linux 9 is installed",
            "TestRef": "oval:com.redhat.cve:tst:20052541003"
          }
        ],
        "Criterias": [
          {
            "Operator": "OR",
            "Criterias": [
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162001"
                  },
                  {
                    "Comment": "kernel-rt is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162002"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-modules is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162003"
                  },
                  {
                    "Comment": "kernel-rt-modules is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162004"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-devel is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162005"
                  },
                  {
                    "Comment": "kernel-rt-debug-devel is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162006"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-devel-matched is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162007"
                  },
                  {
                    "Comment": "kernel-rt-debug-devel-matched is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162008"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-modules-extra is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162009"
                  },
                  {
                    "Comment": "kernel-rt-modules-extra is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162010"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-core is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162011"
                  },
                  {
                    "Comment": "kernel-rt-core is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162012"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-selftests-internal is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162013"
                  },
                  {
                    "Comment": "kernel-rt-selftests-internal is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162014"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-devel is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162015"
                  },
                  {
                    "Comment": "kernel-rt-devel is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162016"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-modules-internal is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162017"
                  },
                  {
                    "Comment": "kernel-rt-modules-internal is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162018"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-modules-internal is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162019"
                  },
                  {
                    "Comment": "kernel-rt-debug-modules-internal is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162020"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-modules-partner is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162021"
                  },
                  {
                    "Comment": "kernel-rt-modules-partner is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162022"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-kvm is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162023"
                  },
                  {
                    "Comment": "kernel-rt-kvm is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162024"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-modules-core is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162025"
                  },
                  {
                    "Comment": "kernel-rt-modules-core is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162026"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-kvm is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162027"
                  },
                  {
                    "Comment": "kernel-rt-debug-kvm is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162028"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-modules-extra is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162029"
                  },
                  {
                    "Comment": "kernel-rt-debug-modules-extra is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162030"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-modules-core is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162031"
                  },
                  {
                    "Comment": "kernel-rt-debug-modules-core is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162032"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-devel-matched is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162033"
                  },
                  {
                    "Comment": "kernel-rt-devel-matched is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162034"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-core is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162035"
                  },
                  {
                    "Comment": "kernel-rt-debug-core is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162036"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-modules-partner is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162037"
                  },
                  {
                    "Comment": "kernel-rt-debug-modules-partner is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162038"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug-modules is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162039"
                  },
                  {
                    "Comment": "kernel-rt-debug-modules is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162040"
                  }
                ]
              },
              {
                "Operator": "AND",
                "Criterions": [
                  {
                    "Comment": "kernel-rt-debug is installed",
                    "TestRef": "oval:com.redhat.cve:tst:201925162041"
                  },
                  {
                    "Comment": "kernel-rt-debug is signed with Red Hat redhatrelease2 key",
                    "TestRef": "oval:com.redhat.cve:tst:201925162042"
                  }
                ]
              }
            ]
          }
        ]
      }
    ]
  }
}