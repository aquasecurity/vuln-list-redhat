{
  "document": {
    "aggregate_severity": {
      "namespace": "https://access.redhat.com/security/updates/classification/",
      "text": "Moderate"
    },
    "category": "csaf_vex",
    "csaf_version": "2.0",
    "distribution": {
      "text": "Copyright Â© Red Hat, Inc. All rights reserved.",
      "tlp": {
        "label": "WHITE",
        "url": "https://www.first.org/tlp/"
      }
    },
    "lang": "en",
    "notes": [
      {
        "category": "legal_disclaimer",
        "text": "This content is licensed under the Creative Commons Attribution 4.0 International License (https://creativecommons.org/licenses/by/4.0/). If you distribute this content, or a modified version of it, you must provide attribution to Red Hat Inc. and provide a link to the original.",
        "title": "Terms of Use"
      }
    ],
    "publisher": {
      "category": "vendor",
      "contact_details": "https://access.redhat.com/security/team/contact/",
      "issuing_authority": "Red Hat Product Security is responsible for vulnerability handling across all Red Hat products and services.",
      "name": "Red Hat Product Security",
      "namespace": "https://www.redhat.com"
    },
    "references": [
      {
        "category": "self",
        "summary": "Canonical URL",
        "url": "https://security.access.redhat.com/data/csaf/v2/vex/2021/cve-2021-47011.json"
      }
    ],
    "title": "kernel: mm: memcontrol: slab: fix obtain a reference to a freeing memcg",
    "tracking": {
      "current_release_date": "2025-01-07T08:23:05+00:00",
      "generator": {
        "date": "2025-01-07T08:23:05+00:00",
        "engine": {
          "name": "Red Hat SDEngine",
          "version": "4.2.5"
        }
      },
      "id": "CVE-2021-47011",
      "initial_release_date": "2021-01-01T00:00:00+00:00",
      "revision_history": [
        {
          "date": "2021-01-01T00:00:00+00:00",
          "number": "1",
          "summary": "Initial version"
        },
        {
          "date": "2024-06-18T20:22:55+00:00",
          "number": "2",
          "summary": "Current version"
        },
        {
          "date": "2025-01-07T08:23:05+00:00",
          "number": "3",
          "summary": "Last generated version"
        }
      ],
      "status": "final",
      "version": "3"
    }
  },
  "product_tree": {
    "branches": [
      {
        "branches": [
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 6",
                "product": {
                  "name": "Red Hat Enterprise Linux 6",
                  "product_id": "red_hat_enterprise_linux_6",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:6"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 6"
          },
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 7",
                "product": {
                  "name": "Red Hat Enterprise Linux 7",
                  "product_id": "red_hat_enterprise_linux_7",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:7"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 7"
          },
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 8",
                "product": {
                  "name": "Red Hat Enterprise Linux 8",
                  "product_id": "red_hat_enterprise_linux_8",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:8"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 8"
          },
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 9",
                "product": {
                  "name": "Red Hat Enterprise Linux 9",
                  "product_id": "red_hat_enterprise_linux_9",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:9"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 9"
          },
          {
            "category": "product_version",
            "name": "kernel",
            "product": {
              "name": "kernel",
              "product_id": "kernel",
              "product_identification_helper": {
                "purl": "pkg:rpm/redhat/kernel?arch=src"
              }
            }
          },
          {
            "category": "product_version",
            "name": "kernel-rt",
            "product": {
              "name": "kernel-rt",
              "product_id": "kernel-rt",
              "product_identification_helper": {
                "purl": "pkg:rpm/redhat/kernel-rt?arch=src"
              }
            }
          }
        ],
        "category": "vendor",
        "name": "Red Hat"
      }
    ],
    "relationships": [
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 6",
          "product_id": "red_hat_enterprise_linux_6:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_6"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 7",
          "product_id": "red_hat_enterprise_linux_7:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_7"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel-rt as a component of Red Hat Enterprise Linux 7",
          "product_id": "red_hat_enterprise_linux_7:kernel-rt"
        },
        "product_reference": "kernel-rt",
        "relates_to_product_reference": "red_hat_enterprise_linux_7"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 8",
          "product_id": "red_hat_enterprise_linux_8:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_8"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel-rt as a component of Red Hat Enterprise Linux 8",
          "product_id": "red_hat_enterprise_linux_8:kernel-rt"
        },
        "product_reference": "kernel-rt",
        "relates_to_product_reference": "red_hat_enterprise_linux_8"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 9",
          "product_id": "red_hat_enterprise_linux_9:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_9"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel-rt as a component of Red Hat Enterprise Linux 9",
          "product_id": "red_hat_enterprise_linux_9:kernel-rt"
        },
        "product_reference": "kernel-rt",
        "relates_to_product_reference": "red_hat_enterprise_linux_9"
      }
    ]
  },
  "vulnerabilities": [
    {
      "cve": "CVE-2021-47011",
      "cwe": {
        "id": "CWE-416",
        "name": "Use After Free"
      },
      "discovery_date": "2024-02-28T00:00:00+00:00",
      "flags": [
        {
          "label": "vulnerable_code_not_present",
          "product_ids": [
            "red_hat_enterprise_linux_9:kernel",
            "red_hat_enterprise_linux_9:kernel-rt"
          ]
        }
      ],
      "ids": [
        {
          "system_name": "Red Hat Bugzilla ID",
          "text": "2266847"
        }
      ],
      "notes": [
        {
          "category": "description",
          "text": "In the Linux kernel, the following vulnerability has been resolved:\n\nmm: memcontrol: slab: fix obtain a reference to a freeing memcg\n\nPatch series \"Use obj_cgroup APIs to charge kmem pages\", v5.\n\nSince Roman's series \"The new cgroup slab memory controller\" applied.\nAll slab objects are charged with the new APIs of obj_cgroup.  The new\nAPIs introduce a struct obj_cgroup to charge slab objects.  It prevents\nlong-living objects from pinning the original memory cgroup in the\nmemory.  But there are still some corner objects (e.g.  allocations\nlarger than order-1 page on SLUB) which are not charged with the new\nAPIs.  Those objects (include the pages which are allocated from buddy\nallocator directly) are charged as kmem pages which still hold a\nreference to the memory cgroup.\n\nE.g.  We know that the kernel stack is charged as kmem pages because the\nsize of the kernel stack can be greater than 2 pages (e.g.  16KB on\nx86_64 or arm64).  If we create a thread (suppose the thread stack is\ncharged to memory cgroup A) and then move it from memory cgroup A to\nmemory cgroup B.  Because the kernel stack of the thread hold a\nreference to the memory cgroup A.  The thread can pin the memory cgroup\nA in the memory even if we remove the cgroup A.  If we want to see this\nscenario by using the following script.  We can see that the system has\nadded 500 dying cgroups (This is not a real world issue, just a script\nto show that the large kmallocs are charged as kmem pages which can pin\nthe memory cgroup in the memory).\n\n\t#!/bin/bash\n\n\tcat /proc/cgroups | grep memory\n\n\tcd /sys/fs/cgroup/memory\n\techo 1 \u003e memory.move_charge_at_immigrate\n\n\tfor i in range{1..500}\n\tdo\n\t\tmkdir kmem_test\n\t\techo $$ \u003e kmem_test/cgroup.procs\n\t\tsleep 3600 \u0026\n\t\techo $$ \u003e cgroup.procs\n\t\techo `cat kmem_test/cgroup.procs` \u003e cgroup.procs\n\t\trmdir kmem_test\n\tdone\n\n\tcat /proc/cgroups | grep memory\n\nThis patchset aims to make those kmem pages to drop the reference to\nmemory cgroup by using the APIs of obj_cgroup.  Finally, we can see that\nthe number of the dying cgroups will not increase if we run the above test\nscript.\n\nThis patch (of 7):\n\nThe rcu_read_lock/unlock only can guarantee that the memcg will not be\nfreed, but it cannot guarantee the success of css_get (which is in the\nrefill_stock when cached memcg changed) to memcg.\n\n  rcu_read_lock()\n  memcg = obj_cgroup_memcg(old)\n  __memcg_kmem_uncharge(memcg)\n      refill_stock(memcg)\n          if (stock-\u003ecached != memcg)\n              // css_get can change the ref counter from 0 back to 1.\n              css_get(\u0026memcg-\u003ecss)\n  rcu_read_unlock()\n\nThis fix is very like the commit:\n\n  eefbfa7fd678 (\"mm: memcg/slab: fix use after free in obj_cgroup_charge\")\n\nFix this by holding a reference to the memcg which is passed to the\n__memcg_kmem_uncharge() before calling __memcg_kmem_uncharge().",
          "title": "Vulnerability description"
        },
        {
          "category": "summary",
          "text": "kernel: mm: memcontrol: slab: fix obtain a reference to a freeing memcg",
          "title": "Vulnerability summary"
        },
        {
          "category": "general",
          "text": "The CVSS score(s) listed for this vulnerability do not reflect the associated product's status, and are included for informational purposes to better understand the severity of this vulnerability.",
          "title": "CVSS score applicability"
        }
      ],
      "product_status": {
        "known_affected": [
          "red_hat_enterprise_linux_6:kernel",
          "red_hat_enterprise_linux_7:kernel",
          "red_hat_enterprise_linux_7:kernel-rt",
          "red_hat_enterprise_linux_8:kernel",
          "red_hat_enterprise_linux_8:kernel-rt"
        ],
        "known_not_affected": [
          "red_hat_enterprise_linux_9:kernel",
          "red_hat_enterprise_linux_9:kernel-rt"
        ]
      },
      "references": [
        {
          "category": "self",
          "summary": "Canonical URL",
          "url": "https://access.redhat.com/security/cve/CVE-2021-47011"
        },
        {
          "category": "external",
          "summary": "RHBZ#2266847",
          "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2266847"
        },
        {
          "category": "external",
          "summary": "https://www.cve.org/CVERecord?id=CVE-2021-47011",
          "url": "https://www.cve.org/CVERecord?id=CVE-2021-47011"
        },
        {
          "category": "external",
          "summary": "https://nvd.nist.gov/vuln/detail/CVE-2021-47011",
          "url": "https://nvd.nist.gov/vuln/detail/CVE-2021-47011"
        },
        {
          "category": "external",
          "summary": "https://lore.kernel.org/linux-cve-announce/2024022831-CVE-2021-47011-5b75@gregkh/T/#u",
          "url": "https://lore.kernel.org/linux-cve-announce/2024022831-CVE-2021-47011-5b75@gregkh/T/#u"
        }
      ],
      "release_date": "2024-02-28T00:00:00+00:00",
      "remediations": [
        {
          "category": "no_fix_planned",
          "details": "Out of support scope",
          "product_ids": [
            "red_hat_enterprise_linux_6:kernel",
            "red_hat_enterprise_linux_7:kernel",
            "red_hat_enterprise_linux_7:kernel-rt"
          ]
        },
        {
          "category": "none_available",
          "details": "Affected",
          "product_ids": [
            "red_hat_enterprise_linux_8:kernel",
            "red_hat_enterprise_linux_8:kernel-rt"
          ]
        }
      ],
      "scores": [
        {
          "cvss_v3": {
            "version": "3.1",
            "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H",
            "attackVector": "LOCAL",
            "attackComplexity": "LOW",
            "privilegesRequired": "LOW",
            "userInteraction": "NONE",
            "scope": "UNCHANGED",
            "confidentialityImpact": "HIGH",
            "integrityImpact": "NONE",
            "availabilityImpact": "HIGH",
            "baseScore": 7.1,
            "baseSeverity": "HIGH"
          },
          "products": [
            "red_hat_enterprise_linux_6:kernel",
            "red_hat_enterprise_linux_7:kernel",
            "red_hat_enterprise_linux_7:kernel-rt",
            "red_hat_enterprise_linux_8:kernel",
            "red_hat_enterprise_linux_8:kernel-rt",
            "red_hat_enterprise_linux_9:kernel",
            "red_hat_enterprise_linux_9:kernel-rt"
          ]
        }
      ],
      "threats": [
        {
          "category": "impact",
          "details": "Moderate",
          "product_ids": [
            "red_hat_enterprise_linux_6:kernel",
            "red_hat_enterprise_linux_7:kernel",
            "red_hat_enterprise_linux_7:kernel-rt",
            "red_hat_enterprise_linux_8:kernel",
            "red_hat_enterprise_linux_8:kernel-rt",
            "red_hat_enterprise_linux_9:kernel",
            "red_hat_enterprise_linux_9:kernel-rt"
          ]
        }
      ],
      "title": "kernel: mm: memcontrol: slab: fix obtain a reference to a freeing memcg"
    }
  ]
}