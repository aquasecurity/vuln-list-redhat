{
  "document": {
    "aggregate_severity": {
      "namespace": "https://access.redhat.com/security/updates/classification/",
      "text": "moderate"
    },
    "category": "csaf_vex",
    "csaf_version": "2.0",
    "distribution": {
      "text": "Copyright Â© Red Hat, Inc. All rights reserved.",
      "tlp": {
        "label": "WHITE",
        "url": "https://www.first.org/tlp/"
      }
    },
    "lang": "en",
    "notes": [
      {
        "category": "legal_disclaimer",
        "text": "This content is licensed under the Creative Commons Attribution 4.0 International License (https://creativecommons.org/licenses/by/4.0/). If you distribute this content, or a modified version of it, you must provide attribution to Red Hat Inc. and provide a link to the original.",
        "title": "Terms of Use"
      }
    ],
    "publisher": {
      "category": "vendor",
      "contact_details": "https://access.redhat.com/security/team/contact/",
      "issuing_authority": "Red Hat Product Security is responsible for vulnerability handling across all Red Hat offerings.",
      "name": "Red Hat Product Security",
      "namespace": "https://www.redhat.com"
    },
    "references": [
      {
        "category": "self",
        "summary": "Canonical URL",
        "url": "https://access.redhat.com/security/data/csaf/v2/vex/2024/cve-2024-42239.json"
      }
    ],
    "title": "kernel: bpf: Fail bpf_timer_cancel when callback is being cancelled",
    "tracking": {
      "current_release_date": "2024-09-17T00:00:11+00:00",
      "generator": {
        "date": "2024-09-17T00:00:11+00:00",
        "engine": {
          "name": "Red Hat SDEngine",
          "version": "3.33.3"
        }
      },
      "id": "CVE-2024-42239",
      "initial_release_date": "2024-08-07T00:00:00+00:00",
      "revision_history": [
        {
          "date": "2024-08-07T00:00:00+00:00",
          "number": "1",
          "summary": "Initial version"
        },
        {
          "date": "2024-08-14T05:38:36+00:00",
          "number": "2",
          "summary": "Current version"
        },
        {
          "date": "2024-09-17T00:00:11+00:00",
          "number": "3",
          "summary": "Last generated version"
        }
      ],
      "status": "final",
      "version": "3"
    }
  },
  "product_tree": {
    "branches": [
      {
        "branches": [
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 6",
                "product": {
                  "name": "Red Hat Enterprise Linux 6",
                  "product_id": "red_hat_enterprise_linux_6",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:6"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 6"
          },
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 7",
                "product": {
                  "name": "Red Hat Enterprise Linux 7",
                  "product_id": "red_hat_enterprise_linux_7",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:7"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 7"
          },
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 8",
                "product": {
                  "name": "Red Hat Enterprise Linux 8",
                  "product_id": "red_hat_enterprise_linux_8",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:8"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 8"
          },
          {
            "branches": [
              {
                "category": "product_name",
                "name": "Red Hat Enterprise Linux 9",
                "product": {
                  "name": "Red Hat Enterprise Linux 9",
                  "product_id": "red_hat_enterprise_linux_9",
                  "product_identification_helper": {
                    "cpe": "cpe:/o:redhat:enterprise_linux:9"
                  }
                }
              }
            ],
            "category": "product_family",
            "name": "Red Hat Enterprise Linux 9"
          },
          {
            "category": "product_version",
            "name": "kernel",
            "product": {
              "name": "kernel",
              "product_id": "kernel",
              "product_identification_helper": {
                "purl": "pkg:rpm/redhat/kernel?arch=src"
              }
            }
          },
          {
            "category": "product_version",
            "name": "kernel-rt",
            "product": {
              "name": "kernel-rt",
              "product_id": "kernel-rt",
              "product_identification_helper": {
                "purl": "pkg:rpm/redhat/kernel-rt?arch=src"
              }
            }
          }
        ],
        "category": "vendor",
        "name": "Red Hat"
      }
    ],
    "relationships": [
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 6",
          "product_id": "red_hat_enterprise_linux_6:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_6"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 7",
          "product_id": "red_hat_enterprise_linux_7:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_7"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel-rt as a component of Red Hat Enterprise Linux 7",
          "product_id": "red_hat_enterprise_linux_7:kernel-rt"
        },
        "product_reference": "kernel-rt",
        "relates_to_product_reference": "red_hat_enterprise_linux_7"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 8",
          "product_id": "red_hat_enterprise_linux_8:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_8"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel-rt as a component of Red Hat Enterprise Linux 8",
          "product_id": "red_hat_enterprise_linux_8:kernel-rt"
        },
        "product_reference": "kernel-rt",
        "relates_to_product_reference": "red_hat_enterprise_linux_8"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel as a component of Red Hat Enterprise Linux 9",
          "product_id": "red_hat_enterprise_linux_9:kernel"
        },
        "product_reference": "kernel",
        "relates_to_product_reference": "red_hat_enterprise_linux_9"
      },
      {
        "category": "default_component_of",
        "full_product_name": {
          "name": "kernel-rt as a component of Red Hat Enterprise Linux 9",
          "product_id": "red_hat_enterprise_linux_9:kernel-rt"
        },
        "product_reference": "kernel-rt",
        "relates_to_product_reference": "red_hat_enterprise_linux_9"
      }
    ]
  },
  "vulnerabilities": [
    {
      "cve": "CVE-2024-42239",
      "cwe": {
        "id": "CWE-99",
        "name": "Improper Control of Resource Identifiers ('Resource Injection')"
      },
      "discovery_date": "2024-08-07T00:00:00+00:00",
      "flags": [
        {
          "label": "vulnerable_code_not_present",
          "product_ids": [
            "red_hat_enterprise_linux_6:kernel",
            "red_hat_enterprise_linux_8:kernel",
            "red_hat_enterprise_linux_8:kernel-rt"
          ]
        }
      ],
      "ids": [
        {
          "system_name": "Red Hat Bugzilla ID",
          "text": "2303507"
        }
      ],
      "notes": [
        {
          "category": "description",
          "text": "In the Linux kernel, the following vulnerability has been resolved:\n\nbpf: Fail bpf_timer_cancel when callback is being cancelled\n\nGiven a schedule:\n\ntimer1 cb\t\t\ttimer2 cb\n\nbpf_timer_cancel(timer2);\tbpf_timer_cancel(timer1);\n\nBoth bpf_timer_cancel calls would wait for the other callback to finish\nexecuting, introducing a lockup.\n\nAdd an atomic_t count named 'cancelling' in bpf_hrtimer. This keeps\ntrack of all in-flight cancellation requests for a given BPF timer.\nWhenever cancelling a BPF timer, we must check if we have outstanding\ncancellation requests, and if so, we must fail the operation with an\nerror (-EDEADLK) since cancellation is synchronous and waits for the\ncallback to finish executing. This implies that we can enter a deadlock\nsituation involving two or more timer callbacks executing in parallel\nand attempting to cancel one another.\n\nNote that we avoid incrementing the cancelling counter for the target\ntimer (the one being cancelled) if bpf_timer_cancel is not invoked from\na callback, to avoid spurious errors. The whole point of detecting\ncur-\u003ecancelling and returning -EDEADLK is to not enter a busy wait loop\n(which may or may not lead to a lockup). This does not apply in case the\ncaller is in a non-callback context, the other side can continue to\ncancel as it sees fit without running into errors.\n\nBackground on prior attempts:\n\nEarlier versions of this patch used a bool 'cancelling' bit and used the\nfollowing pattern under timer-\u003elock to publish cancellation status.\n\nlock(t-\u003elock);\nt-\u003ecancelling = true;\nmb();\nif (cur-\u003ecancelling)\n\treturn -EDEADLK;\nunlock(t-\u003elock);\nhrtimer_cancel(t-\u003etimer);\nt-\u003ecancelling = false;\n\nThe store outside the critical section could overwrite a parallel\nrequests t-\u003ecancelling assignment to true, to ensure the parallely\nexecuting callback observes its cancellation status.\n\nIt would be necessary to clear this cancelling bit once hrtimer_cancel\nis done, but lack of serialization introduced races. Another option was\nexplored where bpf_timer_start would clear the bit when (re)starting the\ntimer under timer-\u003elock. This would ensure serialized access to the\ncancelling bit, but may allow it to be cleared before in-flight\nhrtimer_cancel has finished executing, such that lockups can occur\nagain.\n\nThus, we choose an atomic counter to keep track of all outstanding\ncancellation requests and use it to prevent lockups in case callbacks\nattempt to cancel each other while executing in parallel.",
          "title": "Vulnerability description"
        },
        {
          "category": "summary",
          "text": "kernel: bpf: Fail bpf_timer_cancel when callback is being cancelled",
          "title": "Vulnerability summary"
        },
        {
          "category": "general",
          "text": "The CVSS score(s) listed for this vulnerability do not reflect the associated product's status, and are included for informational purposes to better understand the severity of this vulnerability.",
          "title": "CVSS score applicability"
        }
      ],
      "product_status": {
        "known_affected": [
          "red_hat_enterprise_linux_7:kernel",
          "red_hat_enterprise_linux_7:kernel-rt",
          "red_hat_enterprise_linux_9:kernel",
          "red_hat_enterprise_linux_9:kernel-rt"
        ],
        "known_not_affected": [
          "red_hat_enterprise_linux_6:kernel",
          "red_hat_enterprise_linux_8:kernel",
          "red_hat_enterprise_linux_8:kernel-rt"
        ]
      },
      "references": [
        {
          "category": "self",
          "summary": "Canonical URL",
          "url": "https://access.redhat.com/security/cve/CVE-2024-42239"
        },
        {
          "category": "external",
          "summary": "RHBZ#2303507",
          "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2303507"
        },
        {
          "category": "external",
          "summary": "https://www.cve.org/CVERecord?id=CVE-2024-42239",
          "url": "https://www.cve.org/CVERecord?id=CVE-2024-42239"
        },
        {
          "category": "external",
          "summary": "https://nvd.nist.gov/vuln/detail/CVE-2024-42239",
          "url": "https://nvd.nist.gov/vuln/detail/CVE-2024-42239"
        },
        {
          "category": "external",
          "summary": "https://lore.kernel.org/linux-cve-announce/2024080740-CVE-2024-42239-a15f@gregkh/T",
          "url": "https://lore.kernel.org/linux-cve-announce/2024080740-CVE-2024-42239-a15f@gregkh/T"
        }
      ],
      "release_date": "2024-08-07T00:00:00+00:00",
      "remediations": [
        {
          "category": "no_fix_planned",
          "details": "Out of support scope",
          "product_ids": [
            "red_hat_enterprise_linux_7:kernel",
            "red_hat_enterprise_linux_7:kernel-rt"
          ]
        },
        {
          "category": "no_fix_planned",
          "details": "Will not fix",
          "product_ids": [
            "red_hat_enterprise_linux_9:kernel",
            "red_hat_enterprise_linux_9:kernel-rt"
          ]
        }
      ],
      "scores": [
        {
          "cvss_v3": {
            "version": "3.1",
            "vectorString": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
            "attackVector": "LOCAL",
            "attackComplexity": "LOW",
            "privilegesRequired": "LOW",
            "userInteraction": "NONE",
            "scope": "UNCHANGED",
            "confidentialityImpact": "NONE",
            "integrityImpact": "NONE",
            "availabilityImpact": "HIGH",
            "baseScore": 5.5,
            "baseSeverity": "MEDIUM"
          },
          "products": [
            "red_hat_enterprise_linux_7:kernel",
            "red_hat_enterprise_linux_7:kernel-rt",
            "red_hat_enterprise_linux_9:kernel",
            "red_hat_enterprise_linux_9:kernel-rt"
          ]
        }
      ],
      "threats": [
        {
          "category": "impact",
          "details": "Moderate",
          "product_ids": [
            "red_hat_enterprise_linux_7:kernel",
            "red_hat_enterprise_linux_7:kernel-rt",
            "red_hat_enterprise_linux_9:kernel",
            "red_hat_enterprise_linux_9:kernel-rt"
          ]
        }
      ],
      "title": "kernel: bpf: Fail bpf_timer_cancel when callback is being cancelled"
    }
  ]
}