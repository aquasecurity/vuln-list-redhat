{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Will not fix",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2025-02-27T00:00:00Z",
  "bugzilla": {
    "description": "kernel: net_sched: sch_sfq: don't allow 1 packet limit",
    "id": "2348591",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2348591"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-129",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2024-57996",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nnet_sched: sch_sfq: don't allow 1 packet limit\nThe current implementation does not work correctly with a limit of\n1. iproute2 actually checks for this and this patch adds the check in\nkernel as well.\nThis fixes the following syzkaller reported crash:\nUBSAN: array-index-out-of-bounds in net/sched/sch_sfq.c:210:6\nindex 65535 is out of range for type 'struct sfq_head[128]'\nCPU: 0 PID: 2569 Comm: syz-executor101 Not tainted 5.10.0-smp-DEV #1\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 09/13/2024\nCall Trace:\n__dump_stack lib/dump_stack.c:79 [inline]\ndump_stack+0x125/0x19f lib/dump_stack.c:120\nubsan_epilogue lib/ubsan.c:148 [inline]\n__ubsan_handle_out_of_bounds+0xed/0x120 lib/ubsan.c:347\nsfq_link net/sched/sch_sfq.c:210 [inline]\nsfq_dec+0x528/0x600 net/sched/sch_sfq.c:238\nsfq_dequeue+0x39b/0x9d0 net/sched/sch_sfq.c:500\nsfq_reset+0x13/0x50 net/sched/sch_sfq.c:525\nqdisc_reset+0xfe/0x510 net/sched/sch_generic.c:1026\ntbf_reset+0x3d/0x100 net/sched/sch_tbf.c:319\nqdisc_reset+0xfe/0x510 net/sched/sch_generic.c:1026\ndev_reset_queue+0x8c/0x140 net/sched/sch_generic.c:1296\nnetdev_for_each_tx_queue include/linux/netdevice.h:2350 [inline]\ndev_deactivate_many+0x6dc/0xc20 net/sched/sch_generic.c:1362\n__dev_close_many+0x214/0x350 net/core/dev.c:1468\ndev_close_many+0x207/0x510 net/core/dev.c:1506\nunregister_netdevice_many+0x40f/0x16b0 net/core/dev.c:10738\nunregister_netdevice_queue+0x2be/0x310 net/core/dev.c:10695\nunregister_netdevice include/linux/netdevice.h:2893 [inline]\n__tun_detach+0x6b6/0x1600 drivers/net/tun.c:689\ntun_detach drivers/net/tun.c:705 [inline]\ntun_chr_close+0x104/0x1b0 drivers/net/tun.c:3640\n__fput+0x203/0x840 fs/file_table.c:280\ntask_work_run+0x129/0x1b0 kernel/task_work.c:185\nexit_task_work include/linux/task_work.h:33 [inline]\ndo_exit+0x5ce/0x2200 kernel/exit.c:931\ndo_group_exit+0x144/0x310 kernel/exit.c:1046\n__do_sys_exit_group kernel/exit.c:1057 [inline]\n__se_sys_exit_group kernel/exit.c:1055 [inline]\n__x64_sys_exit_group+0x3b/0x40 kernel/exit.c:1055\ndo_syscall_64+0x6c/0xd0\nentry_SYSCALL_64_after_hwframe+0x61/0xcb\nRIP: 0033:0x7fe5e7b52479\nCode: Unable to access opcode bytes at RIP 0x7fe5e7b5244f.\nRSP: 002b:00007ffd3c800398 EFLAGS: 00000246 ORIG_RAX: 00000000000000e7\nRAX: ffffffffffffffda RBX: 0000000000000000 RCX: 00007fe5e7b52479\nRDX: 000000000000003c RSI: 00000000000000e7 RDI: 0000000000000000\nRBP: 00007fe5e7bcd2d0 R08: ffffffffffffffb8 R09: 0000000000000014\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007fe5e7bcd2d0\nR13: 0000000000000000 R14: 00007fe5e7bcdd20 R15: 00007fe5e7b24270\nThe crash can be also be reproduced with the following (with a tc\nrecompiled to allow for sfq limits of 1):\ntc qdisc add dev dummy0 handle 1: root tbf rate 1Kbit burst 100b lat 1s\n../iproute2-6.9.0/tc/tc qdisc add dev dummy0 handle 2: parent 1:10 sfq limit 1\nifconfig dummy0 up\nping -I dummy0 -f -c2 -W0.1 8.8.8.8\nsleep 1\nScenario that triggers the crash:\n* the first packet is sent and queued in TBF and SFQ; qdisc qlen is 1\n* TBF dequeues: it peeks from SFQ which moves the packet to the\ngso_skb list and keeps qdisc qlen set to 1. TBF is out of tokens so\nit schedules itself for later.\n* the second packet is sent and TBF tries to queues it to SFQ. qdisc\nqlen is now 2 and because the SFQ limit is 1 the packet is dropped\nby SFQ. At this point qlen is 1, and all of the SFQ slots are empty,\nhowever q-\u003etail is not NULL.\nAt this point, assuming no more packets are queued, when sch_dequeue\nruns again it will decrement the qlen for the current empty slot\ncausing an underflow and the subsequent out of bounds access."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-57996\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-57996\nhttps://lore.kernel.org/linux-cve-announce/2025022640-CVE-2024-57996-b670@gregkh/T"
  ]
}