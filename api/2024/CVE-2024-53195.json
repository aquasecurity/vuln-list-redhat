{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-12-27T00:00:00Z",
  "bugzilla": {
    "description": "kernel: KVM: arm64: Get rid of userspace_irqchip_in_use",
    "id": "2334383",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2334383"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2024-53195",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nKVM: arm64: Get rid of userspace_irqchip_in_use\nImproper use of userspace_irqchip_in_use led to syzbot hitting the\nfollowing WARN_ON() in kvm_timer_update_irq():\nWARNING: CPU: 0 PID: 3281 at arch/arm64/kvm/arch_timer.c:459\nkvm_timer_update_irq+0x21c/0x394\nCall trace:\nkvm_timer_update_irq+0x21c/0x394 arch/arm64/kvm/arch_timer.c:459\nkvm_timer_vcpu_reset+0x158/0x684 arch/arm64/kvm/arch_timer.c:968\nkvm_reset_vcpu+0x3b4/0x560 arch/arm64/kvm/reset.c:264\nkvm_vcpu_set_target arch/arm64/kvm/arm.c:1553 [inline]\nkvm_arch_vcpu_ioctl_vcpu_init arch/arm64/kvm/arm.c:1573 [inline]\nkvm_arch_vcpu_ioctl+0x112c/0x1b3c arch/arm64/kvm/arm.c:1695\nkvm_vcpu_ioctl+0x4ec/0xf74 virt/kvm/kvm_main.c:4658\nvfs_ioctl fs/ioctl.c:51 [inline]\n__do_sys_ioctl fs/ioctl.c:907 [inline]\n__se_sys_ioctl fs/ioctl.c:893 [inline]\n__arm64_sys_ioctl+0x108/0x184 fs/ioctl.c:893\n__invoke_syscall arch/arm64/kernel/syscall.c:35 [inline]\ninvoke_syscall+0x78/0x1b8 arch/arm64/kernel/syscall.c:49\nel0_svc_common+0xe8/0x1b0 arch/arm64/kernel/syscall.c:132\ndo_el0_svc+0x40/0x50 arch/arm64/kernel/syscall.c:151\nel0_svc+0x54/0x14c arch/arm64/kernel/entry-common.c:712\nel0t_64_sync_handler+0x84/0xfc arch/arm64/kernel/entry-common.c:730\nel0t_64_sync+0x190/0x194 arch/arm64/kernel/entry.S:598\nThe following sequence led to the scenario:\n- Userspace creates a VM and a vCPU.\n- The vCPU is initialized with KVM_ARM_VCPU_PMU_V3 during\nKVM_ARM_VCPU_INIT.\n- Without any other setup, such as vGIC or vPMU, userspace issues\nKVM_RUN on the vCPU. Since the vPMU is requested, but not setup,\nkvm_arm_pmu_v3_enable() fails in kvm_arch_vcpu_run_pid_change().\nAs a result, KVM_RUN returns after enabling the timer, but before\nincrementing 'userspace_irqchip_in_use':\nkvm_arch_vcpu_run_pid_change()\nret = kvm_arm_pmu_v3_enable()\nif (!vcpu-\u003earch.pmu.created)\nreturn -EINVAL;\nif (ret)\nreturn ret;\n[...]\nif (!irqchip_in_kernel(kvm))\nstatic_branch_inc(\u0026userspace_irqchip_in_use);\n- Userspace ignores the error and issues KVM_ARM_VCPU_INIT again.\nSince the timer is already enabled, control moves through the\nfollowing flow, ultimately hitting the WARN_ON():\nkvm_timer_vcpu_reset()\nif (timer-\u003eenabled)\nkvm_timer_update_irq()\nif (!userspace_irqchip())\nret = kvm_vgic_inject_irq()\nret = vgic_lazy_init()\nif (unlikely(!vgic_initialized(kvm)))\nif (kvm-\u003earch.vgic.vgic_model !=\nKVM_DEV_TYPE_ARM_VGIC_V2)\nreturn -EBUSY;\nWARN_ON(ret);\nTheoretically, since userspace_irqchip_in_use's functionality can be\nsimply replaced by '!irqchip_in_kernel()', get rid of the static key\nto avoid the mismanagement, which also helps with the syzbot issue."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-53195\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-53195\nhttps://lore.kernel.org/linux-cve-announce/2024122724-CVE-2024-53195-772a@gregkh/T"
  ]
}