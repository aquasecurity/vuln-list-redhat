{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-12-27T00:00:00Z",
  "bugzilla": {
    "description": "kernel: smb: Don't leak cfid when reconnect races with open_cached_dir",
    "id": "2334360",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2334360"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "6.3",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-401",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2024-53178",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nsmb: Don't leak cfid when reconnect races with open_cached_dir\nopen_cached_dir() may either race with the tcon reconnection even before\ncompound_send_recv() or directly trigger a reconnection via\nSMB2_open_init() or SMB_query_info_init().\nThe reconnection process invokes invalidate_all_cached_dirs() via\ncifs_mark_open_files_invalid(), which removes all cfids from the\ncfids-\u003eentries list but doesn't drop a ref if has_lease isn't true. This\nresults in the currently-being-constructed cfid not being on the list,\nbut still having a refcount of 2. It leaks if returned from\nopen_cached_dir().\nFix this by setting cfid-\u003ehas_lease when the ref is actually taken; the\ncfid will not be used by other threads until it has a valid time.\nAddresses these kmemleaks:\nunreferenced object 0xffff8881090c4000 (size 1024):\ncomm \"bash\", pid 1860, jiffies 4295126592\nhex dump (first 32 bytes):\n00 01 00 00 00 00 ad de 22 01 00 00 00 00 ad de  ........\".......\n00 ca 45 22 81 88 ff ff f8 dc 4f 04 81 88 ff ff  ..E\"......O.....\nbacktrace (crc 6f58c20f):\n[\u003cffffffff8b895a1e\u003e] __kmalloc_cache_noprof+0x2be/0x350\n[\u003cffffffff8bda06e3\u003e] open_cached_dir+0x993/0x1fb0\n[\u003cffffffff8bdaa750\u003e] cifs_readdir+0x15a0/0x1d50\n[\u003cffffffff8b9a853f\u003e] iterate_dir+0x28f/0x4b0\n[\u003cffffffff8b9a9aed\u003e] __x64_sys_getdents64+0xfd/0x200\n[\u003cffffffff8cf6da05\u003e] do_syscall_64+0x95/0x1a0\n[\u003cffffffff8d00012f\u003e] entry_SYSCALL_64_after_hwframe+0x76/0x7e\nunreferenced object 0xffff8881044fdcf8 (size 8):\ncomm \"bash\", pid 1860, jiffies 4295126592\nhex dump (first 8 bytes):\n00 cc cc cc cc cc cc cc                          ........\nbacktrace (crc 10c106a9):\n[\u003cffffffff8b89a3d3\u003e] __kmalloc_node_track_caller_noprof+0x363/0x480\n[\u003cffffffff8b7d7256\u003e] kstrdup+0x36/0x60\n[\u003cffffffff8bda0700\u003e] open_cached_dir+0x9b0/0x1fb0\n[\u003cffffffff8bdaa750\u003e] cifs_readdir+0x15a0/0x1d50\n[\u003cffffffff8b9a853f\u003e] iterate_dir+0x28f/0x4b0\n[\u003cffffffff8b9a9aed\u003e] __x64_sys_getdents64+0xfd/0x200\n[\u003cffffffff8cf6da05\u003e] do_syscall_64+0x95/0x1a0\n[\u003cffffffff8d00012f\u003e] entry_SYSCALL_64_after_hwframe+0x76/0x7e\nAnd addresses these BUG splats when unmounting the SMB filesystem:\nBUG: Dentry ffff888140590ba0{i=1000000000080,n=/}  still in use (2) [unmount of cifs cifs]\nWARNING: CPU: 3 PID: 3433 at fs/dcache.c:1536 umount_check+0xd0/0x100\nModules linked in:\nCPU: 3 UID: 0 PID: 3433 Comm: bash Not tainted 6.12.0-rc4-g850925a8133c-dirty #49\nHardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 11/12/2020\nRIP: 0010:umount_check+0xd0/0x100\nCode: 8d 7c 24 40 e8 31 5a f4 ff 49 8b 54 24 40 41 56 49 89 e9 45 89 e8 48 89 d9 41 57 48 89 de 48 c7 c7 80 e7 db ac e8 f0 72 9a ff \u003c0f\u003e 0b 58 31 c0 5a 5b 5d 41 5c 41 5d 41 5e 41 5f e9 2b e5 5d 01 41\nRSP: 0018:ffff88811cc27978 EFLAGS: 00010286\nRAX: 0000000000000000 RBX: ffff888140590ba0 RCX: ffffffffaaf20bae\nRDX: dffffc0000000000 RSI: 0000000000000008 RDI: ffff8881f6fb6f40\nRBP: ffff8881462ec000 R08: 0000000000000001 R09: ffffed1023984ee3\nR10: ffff88811cc2771f R11: 00000000016cfcc0 R12: ffff888134383e08\nR13: 0000000000000002 R14: ffff8881462ec668 R15: ffffffffaceab4c0\nFS:  00007f23bfa98740(0000) GS:ffff8881f6f80000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 0000556de4a6f808 CR3: 0000000123c80000 CR4: 0000000000350ef0\nCall Trace:\n\u003cTASK\u003e\nd_walk+0x6a/0x530\nshrink_dcache_for_umount+0x6a/0x200\ngeneric_shutdown_super+0x52/0x2a0\nkill_anon_super+0x22/0x40\ncifs_kill_sb+0x159/0x1e0\ndeactivate_locked_super+0x66/0xe0\ncleanup_mnt+0x140/0x210\ntask_work_run+0xfb/0x170\nsyscall_exit_to_user_mode+0x29f/0x2b0\ndo_syscall_64+0xa1/0x1a0\nentry_SYSCALL_64_after_hwframe+0x76/0x7e\nRIP: 0033:0x7f23bfb93ae7\nCode: ff ff ff ff c3 66 0f 1f 44 00 00 48 8b 0d 11 93 0d 00 f7 d8 64 89 01 b8 ff ff ff ff eb bf 0f 1f 44 00 00 b8 50 00 00 00 0f 05 \u003c48\u003e 3d 01 f0 ff ff 73 01 c3 48 8b 0d e9 92 0d 00 f7 d8 64 89 \n---truncated---"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-53178\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-53178\nhttps://lore.kernel.org/linux-cve-announce/2024122718-CVE-2024-53178-07bf@gregkh/T"
  ]
}