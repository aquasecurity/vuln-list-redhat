{
  "mitigation": "Mitigation for this issue is either not available or the currently available options do not meet the Red Hat Product Security criteria comprising ease of use and deployment, applicability to widespread installation base or stability.",
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-07-12T00:00:00Z",
  "bugzilla": {
    "description": "kernel: btrfs: zoned: allocate dummy checksums for zoned NODATASUM writes",
    "id": "2297546",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2297546"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-476",
  "statement": "Red Hat Enterprise Linux is not impacted by this CVE, as this vulnerability does not affect the specific versions or configurations of the Linux kernel used in its distributions. This ensures that users of Red Hat Enterprise Linux are not exposed to the potential risks associated with this issue and no further action or mitigation is necessary for systems running this operating system.",
  "acknowledgement": "",
  "name": "CVE-2024-40962",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nbtrfs: zoned: allocate dummy checksums for zoned NODATASUM writes\nShin'ichiro reported that when he's running fstests' test-case\nbtrfs/167 on emulated zoned devices, he's seeing the following NULL\npointer dereference in 'btrfs_zone_finish_endio()':\nOops: general protection fault, probably for non-canonical address 0xdffffc0000000011: 0000 [#1] PREEMPT SMP KASAN NOPTI\nKASAN: null-ptr-deref in range [0x0000000000000088-0x000000000000008f]\nCPU: 4 PID: 2332440 Comm: kworker/u80:15 Tainted: G        W          6.10.0-rc2-kts+ #4\nHardware name: Supermicro Super Server/X11SPi-TF, BIOS 3.3 02/21/2020\nWorkqueue: btrfs-endio-write btrfs_work_helper [btrfs]\nRIP: 0010:btrfs_zone_finish_endio.part.0+0x34/0x160 [btrfs]\nRSP: 0018:ffff88867f107a90 EFLAGS: 00010206\nRAX: dffffc0000000000 RBX: 0000000000000000 RCX: ffffffff893e5534\nRDX: 0000000000000011 RSI: 0000000000000004 RDI: 0000000000000088\nRBP: 0000000000000002 R08: 0000000000000001 R09: ffffed1081696028\nR10: ffff88840b4b0143 R11: ffff88834dfff600 R12: ffff88840b4b0000\nR13: 0000000000020000 R14: 0000000000000000 R15: ffff888530ad5210\nFS:  0000000000000000(0000) GS:ffff888e3f800000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\nCR2: 00007f87223fff38 CR3: 00000007a7c6a002 CR4: 00000000007706f0\nDR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000\nDR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400\nPKRU: 55555554\nCall Trace:\n\u003cTASK\u003e\n? __die_body.cold+0x19/0x27\n? die_addr+0x46/0x70\n? exc_general_protection+0x14f/0x250\n? asm_exc_general_protection+0x26/0x30\n? do_raw_read_unlock+0x44/0x70\n? btrfs_zone_finish_endio.part.0+0x34/0x160 [btrfs]\nbtrfs_finish_one_ordered+0x5d9/0x19a0 [btrfs]\n? __pfx_lock_release+0x10/0x10\n? do_raw_write_lock+0x90/0x260\n? __pfx_do_raw_write_lock+0x10/0x10\n? __pfx_btrfs_finish_one_ordered+0x10/0x10 [btrfs]\n? _raw_write_unlock+0x23/0x40\n? btrfs_finish_ordered_zoned+0x5a9/0x850 [btrfs]\n? lock_acquire+0x435/0x500\nbtrfs_work_helper+0x1b1/0xa70 [btrfs]\n? __schedule+0x10a8/0x60b0\n? __pfx___might_resched+0x10/0x10\nprocess_one_work+0x862/0x1410\n? __pfx_lock_acquire+0x10/0x10\n? __pfx_process_one_work+0x10/0x10\n? assign_work+0x16c/0x240\nworker_thread+0x5e6/0x1010\n? __pfx_worker_thread+0x10/0x10\nkthread+0x2c3/0x3a0\n? trace_irq_enable.constprop.0+0xce/0x110\n? __pfx_kthread+0x10/0x10\nret_from_fork+0x31/0x70\n? __pfx_kthread+0x10/0x10\nret_from_fork_asm+0x1a/0x30\n\u003c/TASK\u003e\nEnabling CONFIG_BTRFS_ASSERT revealed the following assertion to\ntrigger:\nassertion failed: !list_empty(\u0026ordered-\u003elist), in fs/btrfs/zoned.c:1815\nThis indicates, that we're missing the checksums list on the\nordered_extent. As btrfs/167 is doing a NOCOW write this is to be\nexpected.\nFurther analysis with drgn confirmed the assumption:\n\u003e\u003e\u003e inode = prog.crashed_thread().stack_trace()[11]['ordered'].inode\n\u003e\u003e\u003e btrfs_inode = drgn.container_of(inode, \"struct btrfs_inode\", \\\n\"vfs_inode\")\n\u003e\u003e\u003e print(btrfs_inode.flags)\n(u32)1\nAs zoned emulation mode simulates conventional zones on regular devices,\nwe cannot use zone-append for writing. But we're only attaching dummy\nchecksums if we're doing a zone-append write.\nSo for NOCOW zoned data writes on conventional zones, also attach a\ndummy checksum.",
    "A NULL pointer dereference was found in the `btrfs_zone_finish_endio()` function in the Linux Kernel during the execution of test-case `btrfs/167` on emulated zoned devices. This issue stems from missing checksum lists for NOCOW writes in zoned mode, as revealed by an assertion failure. The problem occurs because dummy checksums are only attached for zone-append writes, not for NOCOW writes."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-40962\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-40962\nhttps://lore.kernel.org/linux-cve-announce/2024071226-CVE-2024-40962-9b97@gregkh/T"
  ]
}