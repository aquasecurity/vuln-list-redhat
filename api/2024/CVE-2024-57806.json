{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2025-01-11T00:00:00Z",
  "bugzilla": {
    "description": "kernel: btrfs: fix transaction atomicity bug when enabling simple quotas",
    "id": "2337291",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2337291"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-99",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2024-57806",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nbtrfs: fix transaction atomicity bug when enabling simple quotas\nSet squota incompat bit before committing the transaction that enables\nthe feature.\nWith the config CONFIG_BTRFS_ASSERT enabled, an assertion\nfailure occurs regarding the simple quota feature.\n[5.596534] assertion failed: btrfs_fs_incompat(fs_info, SIMPLE_QUOTA), in fs/btrfs/qgroup.c:365\n[5.597098] ------------[ cut here ]------------\n[5.597371] kernel BUG at fs/btrfs/qgroup.c:365!\n[5.597946] CPU: 1 UID: 0 PID: 268 Comm: mount Not tainted 6.13.0-rc2-00031-gf92f4749861b #146\n[5.598450] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.16.2-debian-1.16.2-1 04/01/2014\n[5.599008] RIP: 0010:btrfs_read_qgroup_config+0x74d/0x7a0\n[5.604303]  \u003cTASK\u003e\n[5.605230]  ? btrfs_read_qgroup_config+0x74d/0x7a0\n[5.605538]  ? exc_invalid_op+0x56/0x70\n[5.605775]  ? btrfs_read_qgroup_config+0x74d/0x7a0\n[5.606066]  ? asm_exc_invalid_op+0x1f/0x30\n[5.606441]  ? btrfs_read_qgroup_config+0x74d/0x7a0\n[5.606741]  ? btrfs_read_qgroup_config+0x74d/0x7a0\n[5.607038]  ? try_to_wake_up+0x317/0x760\n[5.607286]  open_ctree+0xd9c/0x1710\n[5.607509]  btrfs_get_tree+0x58a/0x7e0\n[5.608002]  vfs_get_tree+0x2e/0x100\n[5.608224]  fc_mount+0x16/0x60\n[5.608420]  btrfs_get_tree+0x2f8/0x7e0\n[5.608897]  vfs_get_tree+0x2e/0x100\n[5.609121]  path_mount+0x4c8/0xbc0\n[5.609538]  __x64_sys_mount+0x10d/0x150\nThe issue can be easily reproduced using the following reproducer:\nroot@q:linux# cat repro.sh\nset -e\nmkfs.btrfs -q -f /dev/sdb\nmount /dev/sdb /mnt/btrfs\nbtrfs quota enable -s /mnt/btrfs\numount /mnt/btrfs\nmount /dev/sdb /mnt/btrfs\nThe issue is that when enabling quotas, at btrfs_quota_enable(), we set\nBTRFS_QGROUP_STATUS_FLAG_SIMPLE_MODE at fs_info-\u003eqgroup_flags and persist\nit in the quota root in the item with the key BTRFS_QGROUP_STATUS_KEY, but\nwe only set the incompat bit BTRFS_FEATURE_INCOMPAT_SIMPLE_QUOTA after we\ncommit the transaction used to enable simple quotas.\nThis means that if after that transaction commit we unmount the filesystem\nwithout starting and committing any other transaction, or we have a power\nfailure, the next time we mount the filesystem we will find the flag\nBTRFS_QGROUP_STATUS_FLAG_SIMPLE_MODE set in the item with the key\nBTRFS_QGROUP_STATUS_KEY but we will not find the incompat bit\nBTRFS_FEATURE_INCOMPAT_SIMPLE_QUOTA set in the superblock, triggering an\nassertion failure at:\nbtrfs_read_qgroup_config() -\u003e qgroup_read_enable_gen()\nTo fix this issue, set the BTRFS_FEATURE_INCOMPAT_SIMPLE_QUOTA flag\nimmediately after setting the BTRFS_QGROUP_STATUS_FLAG_SIMPLE_MODE.\nThis ensures that both flags are flushed to disk within the same\ntransaction."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-57806\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-57806\nhttps://lore.kernel.org/linux-cve-announce/2025011153-CVE-2024-57806-0afb@gregkh/T"
  ]
}