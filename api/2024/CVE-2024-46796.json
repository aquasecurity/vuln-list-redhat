{
  "mitigation": "To mitigate this issue, prevent module cifs from being loaded. Please see https://access.redhat.com/solutions/41278 for how to blacklist a kernel module to prevent it from loading automatically.",
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Will not fix",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-09-18T00:00:00Z",
  "bugzilla": {
    "description": "kernel: smb: client: fix double put of @cfile in smb2_set_path_size()",
    "id": "2313144",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2313144"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "6.6",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-416",
  "statement": "The bug could happen for the existing connection with fail for the SMB client. Means that impossible to crack server with this, but instead incorrect data from server can lead to the crash of client. The security impact is limited.",
  "acknowledgement": "",
  "name": "CVE-2024-46796",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nsmb: client: fix double put of @cfile in smb2_set_path_size()\nIf smb2_compound_op() is called with a valid @cfile and returned\n-EINVAL, we need to call cifs_get_writable_path() before retrying it\nas the reference of @cfile was already dropped by previous call.\nThis fixes the following KASAN splat when running fstests generic/013\nagainst Windows Server 2022:\nCIFS: Attempting to mount //w22-fs0/scratch\nrun fstests generic/013 at 2024-09-02 19:48:59\n==================================================================\nBUG: KASAN: slab-use-after-free in detach_if_pending+0xab/0x200\nWrite of size 8 at addr ffff88811f1a3730 by task kworker/3:2/176\nCPU: 3 UID: 0 PID: 176 Comm: kworker/3:2 Not tainted 6.11.0-rc6 #2\nHardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 1.16.3-2.fc40\n04/01/2014\nWorkqueue: cifsoplockd cifs_oplock_break [cifs]\nCall Trace:\n\u003cTASK\u003e\ndump_stack_lvl+0x5d/0x80\n? detach_if_pending+0xab/0x200\nprint_report+0x156/0x4d9\n? detach_if_pending+0xab/0x200\n? __virt_addr_valid+0x145/0x300\n? __phys_addr+0x46/0x90\n? detach_if_pending+0xab/0x200\nkasan_report+0xda/0x110\n? detach_if_pending+0xab/0x200\ndetach_if_pending+0xab/0x200\ntimer_delete+0x96/0xe0\n? __pfx_timer_delete+0x10/0x10\n? rcu_is_watching+0x20/0x50\ntry_to_grab_pending+0x46/0x3b0\n__cancel_work+0x89/0x1b0\n? __pfx___cancel_work+0x10/0x10\n? kasan_save_track+0x14/0x30\ncifs_close_deferred_file+0x110/0x2c0 [cifs]\n? __pfx_cifs_close_deferred_file+0x10/0x10 [cifs]\n? __pfx_down_read+0x10/0x10\ncifs_oplock_break+0x4c1/0xa50 [cifs]\n? __pfx_cifs_oplock_break+0x10/0x10 [cifs]\n? lock_is_held_type+0x85/0xf0\n? mark_held_locks+0x1a/0x90\nprocess_one_work+0x4c6/0x9f0\n? find_held_lock+0x8a/0xa0\n? __pfx_process_one_work+0x10/0x10\n? lock_acquired+0x220/0x550\n? __list_add_valid_or_report+0x37/0x100\nworker_thread+0x2e4/0x570\n? __kthread_parkme+0xd1/0xf0\n? __pfx_worker_thread+0x10/0x10\nkthread+0x17f/0x1c0\n? kthread+0xda/0x1c0\n? __pfx_kthread+0x10/0x10\nret_from_fork+0x31/0x60\n? __pfx_kthread+0x10/0x10\nret_from_fork_asm+0x1a/0x30\n\u003c/TASK\u003e\nAllocated by task 1118:\nkasan_save_stack+0x30/0x50\nkasan_save_track+0x14/0x30\n__kasan_kmalloc+0xaa/0xb0\ncifs_new_fileinfo+0xc8/0x9d0 [cifs]\ncifs_atomic_open+0x467/0x770 [cifs]\nlookup_open.isra.0+0x665/0x8b0\npath_openat+0x4c3/0x1380\ndo_filp_open+0x167/0x270\ndo_sys_openat2+0x129/0x160\n__x64_sys_creat+0xad/0xe0\ndo_syscall_64+0xbb/0x1d0\nentry_SYSCALL_64_after_hwframe+0x77/0x7f\nFreed by task 83:\nkasan_save_stack+0x30/0x50\nkasan_save_track+0x14/0x30\nkasan_save_free_info+0x3b/0x70\npoison_slab_object+0xe9/0x160\n__kasan_slab_free+0x32/0x50\nkfree+0xf2/0x300\nprocess_one_work+0x4c6/0x9f0\nworker_thread+0x2e4/0x570\nkthread+0x17f/0x1c0\nret_from_fork+0x31/0x60\nret_from_fork_asm+0x1a/0x30\nLast potentially related work creation:\nkasan_save_stack+0x30/0x50\n__kasan_record_aux_stack+0xad/0xc0\ninsert_work+0x29/0xe0\n__queue_work+0x5ea/0x760\nqueue_work_on+0x6d/0x90\n_cifsFileInfo_put+0x3f6/0x770 [cifs]\nsmb2_compound_op+0x911/0x3940 [cifs]\nsmb2_set_path_size+0x228/0x270 [cifs]\ncifs_set_file_size+0x197/0x460 [cifs]\ncifs_setattr+0xd9c/0x14b0 [cifs]\nnotify_change+0x4e3/0x740\ndo_truncate+0xfa/0x180\nvfs_truncate+0x195/0x200\n__x64_sys_truncate+0x109/0x150\ndo_syscall_64+0xbb/0x1d0\nentry_SYSCALL_64_after_hwframe+0x77/0x7f"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-46796\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-46796\nhttps://lore.kernel.org/linux-cve-announce/2024091855-CVE-2024-46796-41c4@gregkh/T"
  ]
}