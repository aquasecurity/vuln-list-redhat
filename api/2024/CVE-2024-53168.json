{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2024-12-27T00:00:00Z",
  "bugzilla": {
    "description": "kernel: sunrpc: fix one UAF issue caused by sunrpc kernel tcp socket",
    "id": "2334374",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2334374"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "6.7",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-416",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2024-53168",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nsunrpc: fix one UAF issue caused by sunrpc kernel tcp socket\nBUG: KASAN: slab-use-after-free in tcp_write_timer_handler+0x156/0x3e0\nRead of size 1 at addr ffff888111f322cd by task swapper/0/0\nCPU: 0 UID: 0 PID: 0 Comm: swapper/0 Not tainted 6.12.0-rc4-dirty #7\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1\nCall Trace:\n\u003cIRQ\u003e\ndump_stack_lvl+0x68/0xa0\nprint_address_description.constprop.0+0x2c/0x3d0\nprint_report+0xb4/0x270\nkasan_report+0xbd/0xf0\ntcp_write_timer_handler+0x156/0x3e0\ntcp_write_timer+0x66/0x170\ncall_timer_fn+0xfb/0x1d0\n__run_timers+0x3f8/0x480\nrun_timer_softirq+0x9b/0x100\nhandle_softirqs+0x153/0x390\n__irq_exit_rcu+0x103/0x120\nirq_exit_rcu+0xe/0x20\nsysvec_apic_timer_interrupt+0x76/0x90\n\u003c/IRQ\u003e\n\u003cTASK\u003e\nasm_sysvec_apic_timer_interrupt+0x1a/0x20\nRIP: 0010:default_idle+0xf/0x20\nCode: 4c 01 c7 4c 29 c2 e9 72 ff ff ff 90 90 90 90 90 90 90 90 90 90 90 90\n90 90 90 90 f3 0f 1e fa 66 90 0f 00 2d 33 f8 25 00 fb f4 \u003cfa\u003e c3 cc cc cc\ncc 66 66 2e 0f 1f 84 00 00 00 00 00 90 90 90 90 90\nRSP: 0018:ffffffffa2007e28 EFLAGS: 00000242\nRAX: 00000000000f3b31 RBX: 1ffffffff4400fc7 RCX: ffffffffa09c3196\nRDX: 0000000000000000 RSI: 0000000000000000 RDI: ffffffff9f00590f\nRBP: 0000000000000000 R08: 0000000000000001 R09: ffffed102360835d\nR10: ffff88811b041aeb R11: 0000000000000001 R12: 0000000000000000\nR13: ffffffffa202d7c0 R14: 0000000000000000 R15: 00000000000147d0\ndefault_idle_call+0x6b/0xa0\ncpuidle_idle_call+0x1af/0x1f0\ndo_idle+0xbc/0x130\ncpu_startup_entry+0x33/0x40\nrest_init+0x11f/0x210\nstart_kernel+0x39a/0x420\nx86_64_start_reservations+0x18/0x30\nx86_64_start_kernel+0x97/0xa0\ncommon_startup_64+0x13e/0x141\n\u003c/TASK\u003e\nAllocated by task 595:\nkasan_save_stack+0x24/0x50\nkasan_save_track+0x14/0x30\n__kasan_slab_alloc+0x87/0x90\nkmem_cache_alloc_noprof+0x12b/0x3f0\ncopy_net_ns+0x94/0x380\ncreate_new_namespaces+0x24c/0x500\nunshare_nsproxy_namespaces+0x75/0xf0\nksys_unshare+0x24e/0x4f0\n__x64_sys_unshare+0x1f/0x30\ndo_syscall_64+0x70/0x180\nentry_SYSCALL_64_after_hwframe+0x76/0x7e\nFreed by task 100:\nkasan_save_stack+0x24/0x50\nkasan_save_track+0x14/0x30\nkasan_save_free_info+0x3b/0x60\n__kasan_slab_free+0x54/0x70\nkmem_cache_free+0x156/0x5d0\ncleanup_net+0x5d3/0x670\nprocess_one_work+0x776/0xa90\nworker_thread+0x2e2/0x560\nkthread+0x1a8/0x1f0\nret_from_fork+0x34/0x60\nret_from_fork_asm+0x1a/0x30\nReproduction script:\nmkdir -p /mnt/nfsshare\nmkdir -p /mnt/nfs/netns_1\nmkfs.ext4 /dev/sdb\nmount /dev/sdb /mnt/nfsshare\nsystemctl restart nfs-server\nchmod 777 /mnt/nfsshare\nexportfs -i -o rw,no_root_squash *:/mnt/nfsshare\nip netns add netns_1\nip link add name veth_1_peer type veth peer veth_1\nifconfig veth_1_peer 11.11.0.254 up\nip link set veth_1 netns netns_1\nip netns exec netns_1 ifconfig veth_1 11.11.0.1\nip netns exec netns_1 /root/iptables -A OUTPUT -d 11.11.0.254 -p tcp \\\n--tcp-flags FIN FIN  -j DROP\n(note: In my environment, a DESTROY_CLIENTID operation is always sent\nimmediately, breaking the nfs tcp connection.)\nip netns exec netns_1 timeout -s 9 300 mount -t nfs -o proto=tcp,vers=4.1 \\\n11.11.0.254:/mnt/nfsshare /mnt/nfs/netns_1\nip netns del netns_1\nThe reason here is that the tcp socket in netns_1 (nfs side) has been\nshutdown and closed (done in xs_destroy), but the FIN message (with ack)\nis discarded, and the nfsd side keeps sending retransmission messages.\nAs a result, when the tcp sock in netns_1 processes the received message,\nit sends the message (FIN message) in the sending queue, and the tcp timer\nis re-established. When the network namespace is deleted, the net structure\naccessed by tcp's timer handler function causes problems.\nTo fix this problem, let's hold netns refcnt for the tcp kernel socket as\ndone in other modules. This is an ugly hack which can easily be backported\nto earlier kernels. A proper fix which cleans up the interfaces will\nfollow, but may not be so easy to backport."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-53168\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-53168\nhttps://lore.kernel.org/linux-cve-announce/2024122715-CVE-2024-53168-dc92@gregkh/T"
  ]
}