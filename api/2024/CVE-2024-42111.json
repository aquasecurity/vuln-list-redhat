{
  "mitigation": "Mitigation for this issue is either not available or the currently available options do not meet the Red Hat Product Security criteria comprising ease of use and deployment, applicability to widespread installation base or stability.",
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Not affected",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Low",
  "public_date": "2024-07-30T00:00:00Z",
  "bugzilla": {
    "description": "kernel: btrfs: always do the basic checks for btrfs_qgroup_inherit structure",
    "id": "2301474",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2301474"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.2",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:L/I:L/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-125",
  "statement": "Red Hat Enterprise Linux is not impacted by this CVE, as the vulnerability in question does not affect the specific versions or configurations of the Linux kernel used in its distributions. This ensures that users of Red Hat Enterprise Linux are not exposed to the potential risks associated with this issue, and no further action or mitigation is necessary for systems running this operating system.",
  "acknowledgement": "",
  "name": "CVE-2024-42111",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nbtrfs: always do the basic checks for btrfs_qgroup_inherit structure\n[BUG]\nSyzbot reports the following regression detected by KASAN:\nBUG: KASAN: slab-out-of-bounds in btrfs_qgroup_inherit+0x42e/0x2e20 fs/btrfs/qgroup.c:3277\nRead of size 8 at addr ffff88814628ca50 by task syz-executor318/5171\nCPU: 0 PID: 5171 Comm: syz-executor318 Not tainted 6.10.0-rc2-syzkaller-00010-g2ab795141095 #0\nHardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 04/02/2024\nCall Trace:\n\u003cTASK\u003e\n__dump_stack lib/dump_stack.c:88 [inline]\ndump_stack_lvl+0x241/0x360 lib/dump_stack.c:114\nprint_address_description mm/kasan/report.c:377 [inline]\nprint_report+0x169/0x550 mm/kasan/report.c:488\nkasan_report+0x143/0x180 mm/kasan/report.c:601\nbtrfs_qgroup_inherit+0x42e/0x2e20 fs/btrfs/qgroup.c:3277\ncreate_pending_snapshot+0x1359/0x29b0 fs/btrfs/transaction.c:1854\ncreate_pending_snapshots+0x195/0x1d0 fs/btrfs/transaction.c:1922\nbtrfs_commit_transaction+0xf20/0x3740 fs/btrfs/transaction.c:2382\ncreate_snapshot+0x6a1/0x9e0 fs/btrfs/ioctl.c:875\nbtrfs_mksubvol+0x58f/0x710 fs/btrfs/ioctl.c:1029\nbtrfs_mksnapshot+0xb5/0xf0 fs/btrfs/ioctl.c:1075\n__btrfs_ioctl_snap_create+0x387/0x4b0 fs/btrfs/ioctl.c:1340\nbtrfs_ioctl_snap_create_v2+0x1f2/0x3a0 fs/btrfs/ioctl.c:1422\nbtrfs_ioctl+0x99e/0xc60\nvfs_ioctl fs/ioctl.c:51 [inline]\n__do_sys_ioctl fs/ioctl.c:907 [inline]\n__se_sys_ioctl+0xfc/0x170 fs/ioctl.c:893\ndo_syscall_x64 arch/x86/entry/common.c:52 [inline]\ndo_syscall_64+0xf3/0x230 arch/x86/entry/common.c:83\nentry_SYSCALL_64_after_hwframe+0x77/0x7f\nRIP: 0033:0x7fcbf1992509\nRSP: 002b:00007fcbf1928218 EFLAGS: 00000246 ORIG_RAX: 0000000000000010\nRAX: ffffffffffffffda RBX: 00007fcbf1a1f618 RCX: 00007fcbf1992509\nRDX: 0000000020000280 RSI: 0000000050009417 RDI: 0000000000000003\nRBP: 00007fcbf1a1f610 R08: 00007ffea1298e97 R09: 0000000000000000\nR10: 0000000000000000 R11: 0000000000000246 R12: 00007fcbf19eb660\nR13: 00000000200002b8 R14: 00007fcbf19e60c0 R15: 0030656c69662f2e\n\u003c/TASK\u003e\nAnd it also pinned it down to commit b5357cb268c4 (\"btrfs: qgroup: do not\ncheck qgroup inherit if qgroup is disabled\").\n[CAUSE]\nThat offending commit skips the whole qgroup inherit check if qgroup is\nnot enabled.\nBut that also skips the very basic checks like\nnum_ref_copies/num_excl_copies and the structure size checks.\nMeaning if a qgroup enable/disable race is happening at the background,\nand we pass a btrfs_qgroup_inherit structure when the qgroup is\ndisabled, the check would be completely skipped.\nThen at the time of transaction commitment, qgroup is re-enabled and\nbtrfs_qgroup_inherit() is going to use the incorrect structure and\ncausing the above KASAN error.\n[FIX]\nMake btrfs_qgroup_check_inherit() only skip the source qgroup checks.\nSo that even if invalid btrfs_qgroup_inherit structure is passed in, we\ncan still reject invalid ones no matter if qgroup is enabled or not.\nFurthermore we do already have an extra safety inside\nbtrfs_qgroup_inherit(), which would just ignore invalid qgroup sources,\nso even if we only skip the qgroup source check we're still safe."
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2024-42111\nhttps://nvd.nist.gov/vuln/detail/CVE-2024-42111\nhttps://lore.kernel.org/linux-cve-announce/2024073021-CVE-2024-42111-034c@gregkh/T"
  ]
}