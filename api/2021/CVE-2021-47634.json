{
  "mitigation": "To mitigate this issue, prevent module ubi from being loaded. Please see https://access.redhat.com/solutions/41278 for how to blacklist a kernel module to prevent it from loading automatically.",
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Under investigation",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Under investigation",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Will not fix",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Will not fix",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Moderate",
  "public_date": "2025-02-26T00:00:00Z",
  "bugzilla": {
    "description": "kernel: ubi: Fix race condition between ctrl_cdev_ioctl and ubi_cdev_ioctl",
    "id": "2347911",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2347911"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "6.4",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:H/PR:H/UI:N/S:U/C:H/I:H/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "CWE-416",
  "statement": "If UBI being used (that is a software layer above MTD layer which admits use of LVM-like logical volumes on top of MTD devices), then bug use-after-free could happen in ubi_attach function. The additional condition is race with ubi_cdev_ioctl function. The security impact is limited, because of attack complexity and requirement to have access to UBI.",
  "acknowledgement": "",
  "name": "CVE-2021-47634",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nubi: Fix race condition between ctrl_cdev_ioctl and ubi_cdev_ioctl\nHulk Robot reported a KASAN report about use-after-free:\n==================================================================\nBUG: KASAN: use-after-free in __list_del_entry_valid+0x13d/0x160\nRead of size 8 at addr ffff888035e37d98 by task ubiattach/1385\n[...]\nCall Trace:\nklist_dec_and_del+0xa7/0x4a0\nklist_put+0xc7/0x1a0\ndevice_del+0x4d4/0xed0\ncdev_device_del+0x1a/0x80\nubi_attach_mtd_dev+0x2951/0x34b0 [ubi]\nctrl_cdev_ioctl+0x286/0x2f0 [ubi]\nAllocated by task 1414:\ndevice_add+0x60a/0x18b0\ncdev_device_add+0x103/0x170\nubi_create_volume+0x1118/0x1a10 [ubi]\nubi_cdev_ioctl+0xb7f/0x1ba0 [ubi]\nFreed by task 1385:\ncdev_device_del+0x1a/0x80\nubi_remove_volume+0x438/0x6c0 [ubi]\nubi_cdev_ioctl+0xbf4/0x1ba0 [ubi]\n[...]\n==================================================================\nThe lock held by ctrl_cdev_ioctl is ubi_devices_mutex, but the lock held\nby ubi_cdev_ioctl is ubi-\u003edevice_mutex. Therefore, the two locks can be\nconcurrent.\nctrl_cdev_ioctl contains two operations: ubi_attach and ubi_detach.\nubi_detach is bug-free because it uses reference counting to prevent\nconcurrency. However, uif_init and uif_close in ubi_attach may race with\nubi_cdev_ioctl.\nuif_init will race with ubi_cdev_ioctl as in the following stack.\ncpu1                   cpu2                  cpu3\n_______________________|________________________|______________________\nctrl_cdev_ioctl\nubi_attach_mtd_dev\nuif_init\nubi_cdev_ioctl\nubi_create_volume\ncdev_device_add\nubi_add_volume\n// sysfs exist\nkill_volumes\nubi_cdev_ioctl\nubi_remove_volume\ncdev_device_del\n// first free\nubi_free_volume\ncdev_del\n// double free\ncdev_device_del\nAnd uif_close will race with ubi_cdev_ioctl as in the following stack.\ncpu1                   cpu2                  cpu3\n_______________________|________________________|______________________\nctrl_cdev_ioctl\nubi_attach_mtd_dev\nuif_init\nubi_cdev_ioctl\nubi_create_volume\ncdev_device_add\nubi_debugfs_init_dev\n//error goto out_uif;\nuif_close\nkill_volumes\nubi_cdev_ioctl\nubi_remove_volume\ncdev_device_del\n// first free\nubi_free_volume\n// double free\nThe cause of this problem is that commit 714fb87e8bc0 make device\n\"available\" before it becomes accessible via sysfs. Therefore, we\nroll back the modification. We will fix the race condition between\nubi device creation and udev by removing ubi_get_device in\nvol_attribute_show and dev_attribute_show.This avoids accessing\nuninitialized ubi_devices[ubi_num].\nubi_get_device is used to prevent devices from being deleted during\nsysfs execution. However, now kernfs ensures that devices will not\nbe deleted before all reference counting are released.\nThe key process is shown in the following stack.\ndevice_del\ndevice_remove_attrs\ndevice_remove_groups\nsysfs_remove_groups\nsysfs_remove_group\nremove_files\nkernfs_remove_by_name\nkernfs_remove_by_name_ns\n__kernfs_remove\nkernfs_drain"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2021-47634\nhttps://nvd.nist.gov/vuln/detail/CVE-2021-47634\nhttps://lore.kernel.org/linux-cve-announce/2025022646-CVE-2021-47634-f73e@gregkh/T"
  ]
}