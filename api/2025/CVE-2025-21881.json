{
  "affected_release": null,
  "package_state": [
    {
      "product_name": "Red Hat Enterprise Linux 6",
      "fix_state": "Not affected",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:6"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 7",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:7"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 8",
      "fix_state": "Out of support scope",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:8"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Fix deferred",
      "package_name": "kernel",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    },
    {
      "product_name": "Red Hat Enterprise Linux 9",
      "fix_state": "Fix deferred",
      "package_name": "kernel-rt",
      "cpe": "cpe:/o:redhat:enterprise_linux:9"
    }
  ],
  "threat_severity": "Low",
  "public_date": "2025-03-27T00:00:00Z",
  "bugzilla": {
    "description": "kernel: uprobes: Reject the shared zeropage in uprobe_write_opcode()",
    "id": "2355422",
    "url": "https://bugzilla.redhat.com/show_bug.cgi?id=2355422"
  },
  "cvss": {
    "cvss_base_score": "",
    "cvss_scoring_vector": "",
    "status": ""
  },
  "cvss3": {
    "cvss3_base_score": "5.5",
    "cvss3_scoring_vector": "CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H",
    "status": "draft"
  },
  "iava": "",
  "cwe": "",
  "statement": "",
  "acknowledgement": "",
  "name": "CVE-2025-21881",
  "document_distribution": "",
  "details": [
    "In the Linux kernel, the following vulnerability has been resolved:\nuprobes: Reject the shared zeropage in uprobe_write_opcode()\nWe triggered the following crash in syzkaller tests:\nBUG: Bad page state in process syz.7.38  pfn:1eff3\npage: refcount:0 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x1eff3\nflags: 0x3fffff00004004(referenced|reserved|node=0|zone=1|lastcpupid=0x1fffff)\nraw: 003fffff00004004 ffffe6c6c07bfcc8 ffffe6c6c07bfcc8 0000000000000000\nraw: 0000000000000000 0000000000000000 00000000fffffffe 0000000000000000\npage dumped because: PAGE_FLAGS_CHECK_AT_FREE flag(s) set\nHardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.13.0-1ubuntu1.1 04/01/2014\nCall Trace:\n\u003cTASK\u003e\ndump_stack_lvl+0x32/0x50\nbad_page+0x69/0xf0\nfree_unref_page_prepare+0x401/0x500\nfree_unref_page+0x6d/0x1b0\nuprobe_write_opcode+0x460/0x8e0\ninstall_breakpoint.part.0+0x51/0x80\nregister_for_each_vma+0x1d9/0x2b0\n__uprobe_register+0x245/0x300\nbpf_uprobe_multi_link_attach+0x29b/0x4f0\nlink_create+0x1e2/0x280\n__sys_bpf+0x75f/0xac0\n__x64_sys_bpf+0x1a/0x30\ndo_syscall_64+0x56/0x100\nentry_SYSCALL_64_after_hwframe+0x78/0xe2\nBUG: Bad rss-counter state mm:00000000452453e0 type:MM_FILEPAGES val:-1\nThe following syzkaller test case can be used to reproduce:\nr2 = creat(\u0026(0x7f0000000000)='./file0\\x00', 0x8)\nwrite$nbd(r2, \u0026(0x7f0000000580)=ANY=[], 0x10)\nr4 = openat(0xffffffffffffff9c, \u0026(0x7f0000000040)='./file0\\x00', 0x42, 0x0)\nmmap$IORING_OFF_SQ_RING(\u0026(0x7f0000ffd000/0x3000)=nil, 0x3000, 0x0, 0x12, r4, 0x0)\nr5 = userfaultfd(0x80801)\nioctl$UFFDIO_API(r5, 0xc018aa3f, \u0026(0x7f0000000040)={0xaa, 0x20})\nr6 = userfaultfd(0x80801)\nioctl$UFFDIO_API(r6, 0xc018aa3f, \u0026(0x7f0000000140))\nioctl$UFFDIO_REGISTER(r6, 0xc020aa00, \u0026(0x7f0000000100)={{\u0026(0x7f0000ffc000/0x4000)=nil, 0x4000}, 0x2})\nioctl$UFFDIO_ZEROPAGE(r5, 0xc020aa04, \u0026(0x7f0000000000)={{\u0026(0x7f0000ffd000/0x1000)=nil, 0x1000}})\nr7 = bpf$PROG_LOAD(0x5, \u0026(0x7f0000000140)={0x2, 0x3, \u0026(0x7f0000000200)=ANY=[@ANYBLOB=\"1800000000120000000000000000000095\"], \u0026(0x7f0000000000)='GPL\\x00', 0x7, 0x0, 0x0, 0x0, 0x0, '\\x00', 0x0, @fallback=0x30, 0xffffffffffffffff, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x10, 0x0, @void, @value}, 0x94)\nbpf$BPF_LINK_CREATE_XDP(0x1c, \u0026(0x7f0000000040)={r7, 0x0, 0x30, 0x1e, @val=@uprobe_multi={\u0026(0x7f0000000080)='./file0\\x00', \u0026(0x7f0000000100)=[0x2], 0x0, 0x0, 0x1}}, 0x40)\nThe cause is that zero pfn is set to the PTE without increasing the RSS\ncount in mfill_atomic_pte_zeropage() and the refcount of zero folio does\nnot increase accordingly. Then, the operation on the same pfn is performed\nin uprobe_write_opcode()-\u003e__replace_page() to unconditional decrease the\nRSS count and old_folio's refcount.\nTherefore, two bugs are introduced:\n1. The RSS count is incorrect, when process exit, the check_mm() report\nerror \"Bad rss-count\".\n2. The reserved folio (zero folio) is freed when folio-\u003erefcount is zero,\nthen free_pages_prepare-\u003efree_page_is_bad() report error\n\"Bad page state\".\nThere is more, the following warning could also theoretically be triggered:\n__replace_page()\n-\u003e ...\n-\u003e folio_remove_rmap_pte()\n-\u003e VM_WARN_ON_FOLIO(is_zero_folio(folio), folio)\nConsidering that uprobe hit on the zero folio is a very rare case, just\nreject zero old folio immediately after get_user_page_vma_remote().\n[ mingo: Cleaned up the changelog ]"
  ],
  "references": [
    "https://www.cve.org/CVERecord?id=CVE-2025-21881\nhttps://nvd.nist.gov/vuln/detail/CVE-2025-21881\nhttps://lore.kernel.org/linux-cve-announce/2025032712-CVE-2025-21881-7a0f@gregkh/T"
  ]
}